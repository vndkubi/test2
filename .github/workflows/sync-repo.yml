name: üîÑ Sync upstream via PR

on:
  workflow_dispatch:
  schedule:
    - cron: '*/30 * * * *'  # Ch·∫°y m·ªói 30 ph√∫t (ho·∫∑c t√πy ch·ªânh)

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout fork (main branch)
        uses: actions/checkout@v3
        with:
          ref: main
          path: fork

      - name: Set up Git
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

      - name: Add upstream and fetch
        working-directory: fork
        run: |
          git remote add upstream https://github.com/ctson97/test1.git
          git fetch upstream

      - name: Create sync branch from main
        working-directory: fork
        run: |
          git checkout -b sync-upstream

      - name: Merge upstream/main into sync-upstream
        working-directory: fork
        run: |
          git merge upstream/main || echo "Merge conflicts exist ‚Äì continue to PR"

      - name: Push sync-upstream branch
        working-directory: fork
        run: |
          git push origin sync-upstream --force

      - name: Create Pull Request
          uses: peter-evans/create-pull-request@v5
          with:
            token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
            branch: sync-upstream
            title: "üîÅ Sync from upstream test1"
            body: |
              This PR merges changes from [ctson97/test1](https://github.com/ctson97/test1) into this fork.
              It was created automatically by GitHub Actions.
            base: main
          working-directory: fork

